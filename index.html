<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.7">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times; -webkit-text-stroke: #000000}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times; -webkit-text-stroke: #000000; min-height: 14.0px}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Songti TC'; -webkit-text-stroke: #000000}
    span.s1 {font-kerning: none}
    span.s2 {font: 12.0px 'Songti TC'; font-kerning: none}
    span.s3 {font: 12.0px Times; font-kerning: none}
    span.s4 {font: 12.0px 'Noto Sans Lisu'; font-kerning: none}
  </style>
</head>
<body>
<p class="p1"><span class="s1">import React, { useState, useEffect, useRef } from 'react';</span></p>
<p class="p1"><span class="s1">import {<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>Trophy, Activity, RotateCcw, Table, ShieldAlert, UserPlus, Users,<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>ClipboardList, PlayCircle, Plus, Trash2, ChevronLeft, ChevronRight,<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>Filter, Layers, Undo2, Download, MousePointerClick, FileDown,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>ArrowRightLeft, Target, Disc, Timer, Save, Medal, CheckCircle,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>FastForward, AlertTriangle, XCircle, Footprints, UserMinus, RefreshCw,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>Dumbbell, Swords, X, ChevronDown, ArrowUp, UserCog, MoveRight, AlertOctagon,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>Eye, EyeOff, Keyboard, Palette, Shield, Home</span></p>
<p class="p1"><span class="s1">} from 'lucide-react';</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// --- Helper Functions ---</span></p>
<p class="p1"><span class="s1">const isPitcher = (pos) =&gt; ['P', 'SP', 'RP', 'CP'].includes(pos);</span></p>
<p class="p1"><span class="s1">const getPosName = (num) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const map = { '1': 'P', '2': 'C', '3': '1B', '4': '2B', '5': '3B', '6': 'SS', '7': 'LF', '8': 'CF', '9': 'RF' };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return map[num] || '';</span></p>
<p class="p1"><span class="s1">};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// --- 1. </span><span class="s2">輔助組件：投球計時器</span><span class="s1"> ---</span></p>
<p class="p1"><span class="s1">const PitchClock = ({ bases }) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const [timeLeft, setTimeLeft] = useState(null);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const [isActive, setIsActive] = useState(false);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const defaultTime = bases.some(b =&gt; b !== null) ? 20 : 15;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>useEffect(() =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let interval = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (isActive &amp;&amp; timeLeft &gt; 0) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>interval = setInterval(() =&gt; setTimeLeft(p =&gt; p - 1), 1000);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>} else if (timeLeft === 0) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>setIsActive(false);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return () =&gt; clearInterval(interval);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}, [isActive, timeLeft]);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>useEffect(() =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setIsActive(false);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setTimeLeft(null);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}, [bases]);<span class="Apple-converted-space"> </span></span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>return (</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;div className="bg-slate-800 p-2 rounded-lg border border-slate-700 flex items-center justify-between gap-2 shadow-inner mb-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;div className="flex items-center gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;Timer size={14} className="text-slate-400" /&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;span className="text-[10px] font-bold text-slate-400 uppercase"&gt;</span><span class="s2">投球計時</span><span class="s1">&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;div className="flex items-center gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div className={`text-lg font-mono font-black w-8 text-center ${timeLeft === 0 ? 'text-red-500 animate-pulse' : timeLeft &lt;= 5 ? 'text-orange-400' : 'text-white'}`}&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>{timeLeft === null ? '--' : timeLeft}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;button onClick={() =&gt; { setTimeLeft(defaultTime); setIsActive(true); }} className="bg-blue-600 hover:bg-blue-500 text-white text-[10px] px-2 py-1 rounded"&gt;START&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;button onClick={() =&gt; { setIsActive(false); setTimeLeft(null); }} className="bg-slate-700 hover:bg-slate-600 text-slate-300 text-[10px] px-2 py-1 rounded"&gt;RESET&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>);</span></p>
<p class="p1"><span class="s1">};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// --- 2. </span><span class="s2">輔助組件：換人選單</span><span class="s1"> ---</span></p>
<p class="p1"><span class="s1">const SubstitutionModal = ({ teamName, roster, role, currentId, onConfirm, onClose }) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const [showAll, setShowAll] = useState(false);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const filteredRosterWithIndex = roster</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.map((player, index) =&gt; ({ ...player, originalIndex: index }))</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.filter(player =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (showAll) return true;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const playerIsPitcher = isPitcher(player.pos);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (role === 'pitcher') return playerIsPitcher;<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>return !playerIsPitcher;<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return (</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div className="fixed inset-0 bg-black/80 flex items-center justify-center z-[60] p-4 backdrop-blur-sm animate-in fade-in zoom-in duration-200"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div className="bg-slate-800 p-0 rounded-xl border border-slate-600 w-full max-w-sm shadow-2xl overflow-hidden flex flex-col max-h-[80vh]"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div className="p-4 border-b border-slate-700 bg-slate-900/50 flex justify-between items-center"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;h3 className="text-white font-bold flex items-center gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;UserCog size={20} className="text-blue-400"/&gt;<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s2">更換</span><span class="s1">{role === 'batter' ? '</span><span class="s2">打者</span><span class="s1">' : '</span><span class="s2">投手</span><span class="s1">'}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/h3&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button onClick={onClose}&gt;&lt;X size={20} className="text-slate-400 hover:text-white"/&gt;&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div className="p-2 bg-slate-800 border-b border-slate-700 flex justify-between items-center px-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;span className="text-xs text-slate-400"&gt;{teamName}&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>onClick={() =&gt; setShowAll(!showAll)}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>className="flex items-center gap-1 text-xs text-blue-300 hover:text-blue-200"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>{showAll ? &lt;EyeOff size={12}/&gt; : &lt;Eye size={12}/&gt;}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>{showAll ? '</span><span class="s2">依位置篩選</span><span class="s1">' : '</span><span class="s2">顯示全部球員</span><span class="s1">'}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div className="flex-1 overflow-y-auto p-2 space-y-1"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>{filteredRosterWithIndex.length === 0 &amp;&amp; (</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div className="text-center text-slate-500 py-8 text-sm"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s2">沒有符合條件的球員</span><span class="s1">&lt;br/&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;button onClick={() =&gt; setShowAll(true)} className="text-blue-400 underline mt-2"&gt;</span><span class="s2">顯示全部</span><span class="s1">&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>)}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>{filteredRosterWithIndex.map((player) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>const isActive = player.id === currentId;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>const isPitcherPos = isPitcher(player.pos);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>return (</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;button<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>key={player.id}<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>onClick={() =&gt; onConfirm(player.originalIndex)}<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>className={`w-full flex items-center justify-between p-3 rounded-lg border transition active:scale-95 ${isActive ? 'bg-blue-900/40 border-blue-500 ring-1 ring-blue-500' : 'bg-slate-700/50 border-slate-600 hover:bg-slate-700'}`}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;div className="flex items-center gap-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;span className={`font-mono font-bold w-6 text-right ${isActive ? 'text-blue-300' : 'text-slate-400'}`}&gt;{player.number}&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;span className={`font-bold ${isActive ? 'text-white' : 'text-slate-200'}`}&gt;{player.name}&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;span className={`text-xs px-2 py-1 rounded ${isPitcherPos ? 'bg-orange-900/40 text-orange-300' : 'bg-slate-600 text-slate-300'}`}&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                    </span>{player.pos}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>})}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>);</span></p>
<p class="p1"><span class="s1">};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// --- 4. </span><span class="s2">輔助組件：壘包操作選單</span><span class="s1"> ---</span></p>
<p class="p1"><span class="s1">const BaseActionModal = ({ baseIndex, runner, onClose, onAction, roster }) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const baseName = ['</span><span class="s2">一壘</span><span class="s1">', '</span><span class="s2">二壘</span><span class="s1">', '</span><span class="s2">三壘</span><span class="s1">'][baseIndex];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const [selectedPlayerId, setSelectedPlayerId] = useState('');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const handlePlaceRunner = () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (!selectedPlayerId) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// </span><span class="s2">修正</span><span class="s1"> ID </span><span class="s2">生成，避免重複</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>onAction('place_runner', { name: '</span><span class="s2">跑者</span><span class="s1">', number: 'R', id: Date.now() + Math.random() });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const player = roster.find(p =&gt; p.id.toString() === selectedPlayerId);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>onAction('place_runner', player);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>return (</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;div className="fixed inset-0 bg-black/70 flex items-center justify-center z-[60] p-4 backdrop-blur-sm animate-in fade-in zoom-in duration-200"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;div className="bg-slate-800 p-5 rounded-xl border border-slate-600 w-full max-w-xs shadow-2xl relative"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;button onClick={onClose} className="absolute top-3 right-3 text-slate-400 hover:text-white"&gt;&lt;X size={20}/&gt;&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div className="text-center mb-6"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;h3 className="text-white font-bold text-lg"&gt;{baseName}</span><span class="s2">狀態</span><span class="s1">&lt;/h3&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>{runner ? (</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div className="text-blue-400 font-mono font-bold text-xl mt-1 bg-blue-900/30 py-1 rounded border border-blue-500/30"&gt;{runner.number} {runner.name}&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>) : (</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div className="text-slate-500 italic mt-1"&gt;</span><span class="s2">目前無人</span><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>)}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div className="grid grid-cols-1 gap-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>{runner ? (</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;button onClick={() =&gt; onAction('advance')} className="w-full bg-indigo-600 hover:bg-indigo-500 text-white py-3 rounded-lg font-bold flex items-center justify-center gap-2 shadow-lg border border-indigo-500 mb-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;ArrowUp size={20}/&gt; </span><span class="s2">推進一個壘包</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;div className="grid grid-cols-2 gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;button onClick={() =&gt; onAction('sb')} className="bg-green-600 hover:bg-green-500 text-white py-3 rounded-lg font-bold flex flex-col items-center justify-center gap-1 text-xs border border-green-500 shadow-lg"&gt;&lt;Footprints size={18}/&gt; </span><span class="s2">盜壘成功</span><span class="s1">&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;button onClick={() =&gt; onAction('cs')} className="bg-red-600 hover:bg-red-500 text-white py-3 rounded-lg font-bold flex flex-col items-center justify-center gap-1 text-xs border border-red-500 shadow-lg"&gt;&lt;XCircle size={18}/&gt; </span><span class="s2">盜壘失敗</span><span class="s1">&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;button onClick={() =&gt; onAction('pickoff')} className="bg-orange-700 hover:bg-orange-600 text-white py-2 rounded-lg font-bold flex flex-col items-center justify-center gap-1 text-xs border border-orange-600"&gt;&lt;Target size={16}/&gt; </span><span class="s2">牽制出局</span><span class="s1">&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;button onClick={() =&gt; onAction('pr')} className="bg-slate-600 hover:bg-slate-500 text-white py-2 rounded-lg font-bold flex flex-col items-center justify-center gap-1 text-xs border border-slate-500"&gt;&lt;ArrowRightLeft size={16}/&gt; </span><span class="s2">換代跑</span><span class="s1">&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;button onClick={() =&gt; onAction('remove')} className="bg-slate-800 border border-slate-500 hover:bg-slate-700 text-slate-300 py-3 rounded-lg text-xs flex items-center justify-center gap-2 transition"&gt;&lt;UserMinus size={16}/&gt; </span><span class="s2">僅移除跑者</span><span class="s1"> (</span><span class="s2">得分</span><span class="s1">/</span><span class="s2">修正</span><span class="s1">)&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>) : (</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div className="space-y-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div className="text-xs text-slate-400 mb-1"&gt;</span><span class="s2">選擇球員上壘</span><span class="s1"> (</span><span class="s2">代跑</span><span class="s1">/</span><span class="s2">修正</span><span class="s1">)</span><span class="s2">：</span><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;select<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>className="w-full bg-slate-900 border border-slate-600 rounded p-2 text-white text-sm"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>value={selectedPlayerId}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>onChange={(e) =&gt; setSelectedPlayerId(e.target.value)}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;option value=""&gt;-- </span><span class="s2">選擇球員</span><span class="s1"> --&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>{roster &amp;&amp; roster.map(p =&gt; (</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;option key={p.id} value={p.id}&gt;#{p.number} {p.name}&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>))}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/select&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;button onClick={handlePlaceRunner} className="w-full bg-blue-600 hover:bg-blue-500 text-white py-3 rounded-lg font-bold flex items-center justify-center gap-2 shadow-lg"&gt;&lt;UserPlus size={18}/&gt; </span><span class="s2">確認放置</span><span class="s1">&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>)}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>);</span></p>
<p class="p1"><span class="s1">};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// --- 5. </span><span class="s2">輔助組件：守備位置選擇器</span><span class="s1"> ---</span></p>
<p class="p1"><span class="s1">const FielderSelector = ({ onSelect, onCancel, title = "</span><span class="s2">守備位置</span><span class="s1">" }) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const positions = [{ num: '1', name: 'P' }, { num: '2', name: 'C' }, { num: '3', name: '1B' }, { num: '4', name: '2B' }, { num: '5', name: '3B' }, { num: '6', name: 'SS' }, { num: '7', name: 'LF' }, { num: '8', name: 'CF' }, { num: '9', name: 'RF' }];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>return (</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;div className="fixed inset-0 bg-black/70 flex items-center justify-center z-[60] p-4 backdrop-blur-sm"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;div className="bg-slate-800 p-6 rounded-xl shadow-2xl border border-slate-600 w-full max-w-sm"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;h3 className="text-white font-bold text-lg mb-4 text-center"&gt;{title}&lt;/h3&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div className="grid grid-cols-3 gap-3 mb-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>{positions.map(p =&gt; (</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;button key={p.num} onClick={() =&gt; onSelect(p.num)} className="bg-slate-700 hover:bg-blue-600 text-white py-3 rounded-lg font-bold border border-slate-600 transition flex flex-col items-center justify-center group"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;span className="text-xl group-hover:scale-110 transition"&gt;{p.num}&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;span className="text-[10px] text-slate-400"&gt;{p.name}&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>))}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;button onClick={onCancel} className="w-full py-3 bg-slate-600 hover:bg-slate-500 text-white rounded-lg font-bold"&gt;</span><span class="s2">取消</span><span class="s1">&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>);</span></p>
<p class="p1"><span class="s1">};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// --- 6. </span><span class="s2">輔助組件：賽後結算</span><span class="s1"> ---</span></p>
<p class="p1"><span class="s1">const GameSummaryModal = ({ scores, teams, rosters, onSave, onClose }) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const [decisions, setDecisions] = useState({ win: '', loss: '', save: '', mvp: '' });</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">  </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const getAllPitchers = () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const all = [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>['away', 'home'].forEach(teamKey =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>rosters[teamKey].forEach(p =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (['P', 'SP', 'RP', 'CP'].includes(p.pos) || (p.pitching &amp;&amp; (p.pitching.np &gt; 0 || p.pitching.ip &gt; 0))) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>all.push({ ...p, team: teamKey === 'away' ? teams.away : teams.home });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return all;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const getAllPlayers = () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const all = [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>['away', 'home'].forEach(teamKey =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>rosters[teamKey].forEach(p =&gt; all.push({ ...p, team: teamKey === 'away' ? teams.away : teams.home }));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return all;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>return (</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;div className="fixed inset-0 bg-black/80 flex items-center justify-center z-[60] p-4 backdrop-blur-md animate-in fade-in duration-300"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;div className="bg-slate-800 p-6 rounded-xl shadow-2xl border border-slate-600 w-full max-w-md max-h-[90vh] overflow-y-auto"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div className="text-center mb-6"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;Trophy size={48} className="mx-auto text-yellow-400 mb-2" /&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;h2 className="text-2xl font-bold text-white"&gt;</span><span class="s2">比賽結束</span><span class="s1">&lt;/h2&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div className="text-4xl font-mono font-black my-2 flex justify-center items-center gap-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;span className={scores.away &gt; scores.home ? 'text-yellow-400' : 'text-slate-400'}&gt;{scores.away}&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;span className="text-xl text-slate-600"&gt;-&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;span className={scores.home &gt; scores.away ? 'text-yellow-400' : 'text-slate-400'}&gt;{scores.home}&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div className="space-y-3 mb-6"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>{['</span><span class="s2">勝投</span><span class="s1">', '</span><span class="s2">敗投</span><span class="s1">', '</span><span class="s2">救援</span><span class="s1">', 'MVP'].map((label, i) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const field = ['win', 'loss', 'save', 'mvp'][i];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const list = field === 'mvp' ? getAllPlayers() : getAllPitchers();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>return (</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div key={field}&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;label className="block text-xs text-slate-400 mb-1"&gt;{label}&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;select className="w-full bg-slate-700 text-white p-2 rounded border border-slate-600 text-sm" onChange={e =&gt; setDecisions({...decisions, [field]: e.target.value})}&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;option value=""&gt;</span><span class="s2">選擇球員</span><span class="s1">&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>{list.map(p =&gt; &lt;option key={p.id} value={p.name}&gt;{p.name} ({p.team})&lt;/option&gt;)}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/select&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>})}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div className="flex gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;button onClick={() =&gt; onSave(decisions)} className="flex-1 bg-blue-600 hover:bg-blue-500 text-white py-3 rounded-lg font-bold flex items-center justify-center gap-2"&gt;&lt;Save size={18}/&gt; </span><span class="s2">儲存並結束</span><span class="s1">&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;button onClick={onClose} className="px-4 bg-slate-700 hover:bg-slate-600 text-slate-300 rounded-lg"&gt;</span><span class="s2">返回</span><span class="s1">&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>);</span></p>
<p class="p1"><span class="s1">};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// --- 8. </span><span class="s2">輔助組件：快捷鍵說明</span><span class="s1"> ---</span></p>
<p class="p1"><span class="s1">const HotkeyHelpModal = ({ onClose }) =&gt; (</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;div className="fixed inset-0 bg-black/80 flex items-center justify-center z-[70] p-4 backdrop-blur-sm animate-in fade-in zoom-in duration-200"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div className="bg-slate-800 p-6 rounded-xl border border-slate-600 w-full max-w-sm shadow-2xl relative"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;button onClick={onClose} className="absolute top-3 right-3 text-slate-400 hover:text-white"&gt;&lt;X size={20}/&gt;&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;h3 className="text-white font-bold text-lg mb-4 flex items-center gap-2"&gt;&lt;Keyboard size={20}/&gt; </span><span class="s2">鍵盤快捷鍵</span><span class="s1">&lt;/h3&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div className="grid grid-cols-2 gap-4 text-sm"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div className="space-y-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div className="text-slate-400 text-xs uppercase font-bold border-b border-slate-700 pb-1 mb-2"&gt;</span><span class="s2">投球判定</span><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div className="flex justify-between"&gt;&lt;span className="text-white font-mono bg-slate-700 px-1.5 rounded"&gt;B&lt;/span&gt; &lt;span className="text-slate-300"&gt;</span><span class="s2">壞球</span><span class="s1">&lt;/span&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div className="flex justify-between"&gt;&lt;span className="text-white font-mono bg-slate-700 px-1.5 rounded"&gt;S&lt;/span&gt; &lt;span className="text-slate-300"&gt;</span><span class="s2">揮棒落空</span><span class="s1">&lt;/span&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div className="flex justify-between"&gt;&lt;span className="text-white font-mono bg-slate-700 px-1.5 rounded"&gt;K&lt;/span&gt; &lt;span className="text-slate-300"&gt;</span><span class="s2">目送好球</span><span class="s1">&lt;/span&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div className="flex justify-between"&gt;&lt;span className="text-white font-mono bg-slate-700 px-1.5 rounded"&gt;F&lt;/span&gt; &lt;span className="text-slate-300"&gt;</span><span class="s2">界外球</span><span class="s1">&lt;/span&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div className="space-y-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div className="text-slate-400 text-xs uppercase font-bold border-b border-slate-700 pb-1 mb-2"&gt;</span><span class="s2">打擊結果</span><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div className="flex justify-between"&gt;&lt;span className="text-white font-mono bg-slate-700 px-1.5 rounded"&gt;1&lt;/span&gt; &lt;span className="text-slate-300"&gt;</span><span class="s2">一壘安打</span><span class="s1">&lt;/span&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div className="flex justify-between"&gt;&lt;span className="text-white font-mono bg-slate-700 px-1.5 rounded"&gt;2&lt;/span&gt; &lt;span className="text-slate-300"&gt;</span><span class="s2">二壘安打</span><span class="s1">&lt;/span&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div className="flex justify-between"&gt;&lt;span className="text-white font-mono bg-slate-700 px-1.5 rounded"&gt;3&lt;/span&gt; &lt;span className="text-slate-300"&gt;</span><span class="s2">三壘安打</span><span class="s1">&lt;/span&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div className="flex justify-between"&gt;&lt;span className="text-white font-mono bg-slate-700 px-1.5 rounded"&gt;4&lt;/span&gt; &lt;span className="text-slate-300"&gt;</span><span class="s2">全壘打</span><span class="s1">&lt;/span&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div className="mt-4 pt-4 border-t border-slate-700 text-xs text-slate-500 text-center"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s2">僅在「比賽</span><span class="s1"> (Play)</span><span class="s2">」分頁且無輸入框焦點時有效</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// --- 9. </span><span class="s2">主應用程式</span><span class="s1"> ---</span></p>
<p class="p1"><span class="s1">export default function App() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const [currentView, setCurrentView] = useState('scorer');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const [boxScoreType, setBoxScoreType] = useState('batting');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const [rosterType, setRosterType] = useState('batter');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const [history, setHistory] = useState([]);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const [gameStarted, setGameStarted] = useState(false);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const [gameEnded, setGameEnded] = useState(false);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const [showSummary, setShowSummary] = useState(false);<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const [teams, setTeams] = useState({ away: 'LAD (</span><span class="s2">道奇</span><span class="s1">)', home: 'NYY (</span><span class="s2">洋基</span><span class="s1">)' });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const [teamColors, setTeamColors] = useState({ away: '#3b82f6', home: '#ef4444' }); // </span><span class="s2">新增：隊伍顏色</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">  </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const [rosters, setRosters] = useState({ away: [], home: [] });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const [newPlayer, setNewPlayer] = useState({ number: '', name: '', pos: '' });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const [activeRosterTeam, setActiveRosterTeam] = useState('away');<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const [batterIndices, setBatterIndices] = useState({ away: 0, home: 0 });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const [pitcherIndices, setPitcherIndices] = useState({ away: 0, home: 0 });</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const [showHotkeysHelp, setShowHotkeysHelp] = useState(false);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const [hitLocation, setHitLocation] = useState('</span><span class="s2">內野</span><span class="s1">');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const [activeBaseAction, setActiveBaseAction] = useState(null);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const [showFielderSelector, setShowFielderSelector] = useState({ show: false, mode: 'out' }); // </span><span class="s2">修改：支援模式</span><span class="s1"> (out/error)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const [pendingOutType, setPendingOutType] = useState(null);<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const [showAdvanceModal, setShowAdvanceModal] = useState(false); // Keep for Wild Pitch logic</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const [subModal, setSubModal] = useState({ isOpen: false, role: null });</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">  </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>// Reset Confirm State</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const [resetConfirmState, setResetConfirmState] = useState(false);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const [scores, setScores] = useState({ away: 0, home: 0 });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const [stats, setStats] = useState({ away: { hits: 0, errors: 0 }, home: { hits: 0, errors: 0 } });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const [lineScores, setLineScores] = useState({ away: {}, home: {} });</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const [inning, setInning] = useState({ number: 1, isTop: true });<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const [outs, setOuts] = useState(0);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const [balls, setBalls] = useState(0);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const [strikes, setStrikes] = useState(0);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const [pitchCount, setPitchCount] = useState(0);<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const [bases, setBases] = useState([null, null, null]);<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const [pitchSequence, setPitchSequence] = useState([]);<span class="Apple-converted-space"> </span></span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const [logs, setLogs] = useState([]);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const logsEndRef = useRef(null);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const [logFilter, setLogFilter] = useState('all');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>// --- Helper: Sanitize Player Data ---</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const sanitizePlayer = (p) =&gt; ({</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>...p,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ab: p.ab || 0, h: p.h || 0, r: p.r || 0, rbi: p.rbi || 0, bb: p.bb || 0, hbp: p.hbp || 0, so: p.so || 0, sf: p.sf || 0, sh: p.sh || 0, b1: p.b1 || 0, b2: p.b2 || 0, b3: p.b3 || 0, hr: p.hr || 0, sb: p.sb || 0, cs: p.cs || 0,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>pitching: p.pitching || { ip: 0, h: 0, r: 0, er: 0, bb: 0, so: 0, np: 0 },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>fielding: p.fielding || { po: 0, a: 0, e: 0 } // </span><span class="s2">新增：守備數據</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>// --- LocalStorage ---</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>useEffect(() =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>try {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const savedState = localStorage.getItem('baseball_scorer_v27_final');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (savedState) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>const parsedState = JSON.parse(savedState);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>if (parsedState &amp;&amp; parsedState.gameStarted) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">             </span>if (parsedState.rosters &amp;&amp; parsedState.scores) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                 </span>if (parsedState.rosters.away) parsedState.rosters.away = parsedState.rosters.away.map(sanitizePlayer);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                 </span>if (parsedState.rosters.home) parsedState.rosters.home = parsedState.rosters.home.map(sanitizePlayer);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                 </span>if(!gameStarted &amp;&amp; confirm('</span><span class="s2">發現未完成的比賽紀錄，是否繼續？</span><span class="s1">')) loadState(parsedState);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">             </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>} catch (e) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>console.error("LocalStorage Error", e);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>localStorage.removeItem('baseball_scorer_v27_final');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}, []);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>useEffect(() =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (gameStarted) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const currentState = {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>scores, stats, lineScores, inning, outs, balls, strikes,<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>bases, logs, rosters, batterIndices, pitcherIndices, gameStarted, gameEnded, teams, pitchSequence, teamColors</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>};</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>localStorage.setItem('baseball_scorer_v27_final', JSON.stringify(currentState));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}, [scores, stats, inning, outs, balls, strikes, bases, logs, rosters, batterIndices, pitcherIndices, gameStarted, gameEnded, teams, pitchSequence, teamColors]);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>useEffect(() =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (logsEndRef.current &amp;&amp; currentView === 'logs' &amp;&amp; logFilter === 'all') {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>logsEndRef.current.scrollIntoView({ behavior: "smooth" });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}, [logs, currentView, logFilter]);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>// --- Keyboard Hotkeys Effect ---</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>useEffect(() =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const handleKeyDown = (e) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (['INPUT', 'SELECT', 'TEXTAREA'].includes(document.activeElement.tagName)) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (currentView !== 'scorer' || gameEnded || !gameStarted) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const key = e.key.toLowerCase();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>switch(key) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'b': handleBall(); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 's': handleStrike(false); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'k': handleStrike(true); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'f': handleFoul(); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case '1': handleHit(1); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case '2': handleHit(2); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case '3': handleHit(3); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case '4': handleHit(4); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>default: break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>};</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>window.addEventListener('keydown', handleKeyDown);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return () =&gt; window.removeEventListener('keydown', handleKeyDown);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const loadState = (state) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (!state) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setScores(state.scores || { away: 0, home: 0 });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setStats(state.stats || { away: { hits: 0, errors: 0 }, home: { hits: 0, errors: 0 } });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setLineScores(state.lineScores || { away: {}, home: {} });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setInning(state.inning || { number: 1, isTop: true });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setOuts(state.outs || 0);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setBalls(state.balls || 0);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setStrikes(state.strikes || 0);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setBases(state.bases || [null, null, null]);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setLogs(state.logs || []);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setRosters(state.rosters || { away: [], home: [] });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setBatterIndices(state.batterIndices || { away: 0, home: 0 });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setPitcherIndices(state.pitcherIndices || { away: 0, home: 0 });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setGameStarted(state.gameStarted || false);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setGameEnded(state.gameEnded || false);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setTeams(state.teams || { away: 'Guest', home: 'Home' });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setTeamColors(state.teamColors || { away: '#3b82f6', home: '#ef4444' });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setPitchSequence(state.pitchSequence || []);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const hardReset = () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>localStorage.removeItem('baseball_scorer_v27_final');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>window.location.reload();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>// --- Logic Helpers ---</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const saveHistory = () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const currentState = {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>scores, stats, lineScores, inning, outs, balls, strikes,<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>bases, logs, rosters, batterIndices, pitcherIndices, gameStarted, gameEnded, teams, pitchSequence, teamColors</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>};</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setHistory(prev =&gt; [...prev.slice(-49), JSON.stringify(currentState)]);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const handleUndo = () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (history.length === 0) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>try {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const previousState = JSON.parse(history[history.length - 1]);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>loadState(previousState);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>setHistory(prev =&gt; prev.slice(0, -1));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>} catch(e) { console.error(e); }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const updatePlayerStat = (teamKey, playerId, statChanges, type = 'batting') =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setRosters(prev =&gt; ({</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>...prev,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>[teamKey]: prev[teamKey].map(p =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (p.id === playerId) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>const newStats = sanitizePlayer({ ...p });<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>Object.keys(statChanges).forEach(key =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (type === 'pitching') newStats.pitching[key] = (newStats.pitching[key] || 0) + statChanges[key];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>else if (type === 'fielding') newStats.fielding[key] = (newStats.fielding[key] || 0) + statChanges[key];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>else newStats[key] = (newStats[key] || 0) + statChanges[key];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>return newStats;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>return p;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>})</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p3"><span class="s3"><span class="Apple-converted-space">  </span>// </span><span class="s1">輔助：尋找特定守備位置的球員</span><span class="s3"> (</span><span class="s1">如果名單中有多個相同位置，取第一個</span><span class="s3">)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const findFielderByPos = (teamKey, posNum) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const posName = getPosName(posNum);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// </span><span class="s2">簡單對應：名單中的</span><span class="s1"> 'SS' </span><span class="s2">對應</span><span class="s1"> posNum '6'</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// </span><span class="s2">投手</span><span class="s1"> P/SP/RP </span><span class="s2">都視為</span><span class="s1"> '1'</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return rosters[teamKey].find(p =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (posNum === '1') return ['P', 'SP', 'RP', 'CP'].includes(p.pos);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>return p.pos === posName;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const getCurrentPitcher = () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const defenseTeamKey = inning.isTop ? 'home' : 'away';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const index = pitcherIndices[defenseTeamKey];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const teamRoster = rosters[defenseTeamKey];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return (teamRoster &amp;&amp; teamRoster.length &gt; 0) ? teamRoster[index % teamRoster.length] : null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const getCurrentBatter = () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const offenseTeamKey = inning.isTop ? 'away' : 'home';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const index = batterIndices[offenseTeamKey];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const teamRoster = rosters[offenseTeamKey];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return (teamRoster &amp;&amp; teamRoster.length &gt; 0) ? teamRoster[index % teamRoster.length] : null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const advanceBatter = () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const teamKey = inning.isTop ? 'away' : 'home';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const teamRoster = rosters[teamKey];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (!teamRoster || teamRoster.length === 0) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setBatterIndices(prev =&gt; ({ ...prev, [teamKey]: (prev[teamKey] + 1) % teamRoster.length }));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const substitutePlayer = (role, changeDirection) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const isTop = inning.isTop;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const teamKey = role === 'batter' ? (isTop ? 'away' : 'home') : (isTop ? 'home' : 'away');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const currentIndex = role === 'batter' ? batterIndices[teamKey] : pitcherIndices[teamKey];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const teamRoster = rosters[teamKey];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (!teamRoster || teamRoster.length === 0) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let newIndex = currentIndex + changeDirection;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (newIndex &lt; 0) newIndex = teamRoster.length - 1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (newIndex &gt;= teamRoster.length) newIndex = 0;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (role === 'batter') setBatterIndices(prev =&gt; ({ ...prev, [teamKey]: newIndex }));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>else setPitcherIndices(prev =&gt; ({ ...prev, [teamKey]: newIndex }));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const openSubstitutionModal = (role) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>setSubModal({ isOpen: true, role });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const handleSubstitutionConfirm = (originalIndex) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const role = subModal.role;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const isTop = inning.isTop;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const teamKey = role === 'batter' ? (isTop ? 'away' : 'home') : (isTop ? 'home' : 'away');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const teamRoster = rosters[teamKey];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const newPlayer = teamRoster[originalIndex];</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>saveHistory();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (role === 'batter') setBatterIndices(prev =&gt; ({ ...prev, [teamKey]: originalIndex }));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>else setPitcherIndices(prev =&gt; ({ ...prev, [teamKey]: originalIndex }));</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">      </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>addLog(`</span><span class="s2">更換</span><span class="s1">${role === 'batter' ? '</span><span class="s2">打者</span><span class="s1">/</span><span class="s2">代打</span><span class="s1">' : '</span><span class="s2">投手</span><span class="s1">'}</span><span class="s2">：</span><span class="s1">${newPlayer.name}`, 'system');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>setSubModal({ isOpen: false, role: null });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const exportLogs = () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const element = document.createElement("a");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const fileContent = JSON.stringify({ gameInfo: { teams, scores, date: new Date().toLocaleDateString() }, rosters, logs }, null, 2);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const file = new Blob([fileContent], {type: 'text/plain'});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>element.href = URL.createObjectURL(file);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>element.download = `baseball_scorer_v27_final_${new Date().toISOString().slice(0,10)}.json`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>document.body.appendChild(element);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>element.click();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>document.body.removeChild(element);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const addLog = (message, type = 'neutral') =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const timestamp = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const teamName = inning.isTop ? teams.away : teams.home;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const inningStr = `${inning.number}${inning.isTop ? '</span><span class="s2">上</span><span class="s1">' : '</span><span class="s2">下</span><span class="s1">'}`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const inningFullStr = `</span><span class="s2">第</span><span class="s1"> ${inning.number} </span><span class="s2">局</span><span class="s1"> - ${inning.isTop ? '</span><span class="s2">上半</span><span class="s1">' : '</span><span class="s2">下半</span><span class="s1">'}`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let finalMessage = message;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// </span><span class="s2">修正</span><span class="s1"> ID </span><span class="s2">生成，確保唯一性，避免</span><span class="s1"> React key </span><span class="s2">錯誤</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setLogs(prev =&gt; [...prev, { id: Date.now() + Math.random(), inningLabel: inningStr, inningGroup: inningFullStr, team: teamName, action: finalMessage, type, time: timestamp }]);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>// --- Logic ---</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const resetCount = () =&gt; { setBalls(0); setStrikes(0); setPitchSequence([]); };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const recordPitch = (result) =&gt; {<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setPitchSequence(prev =&gt; [...prev, result]);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const pitcher = getCurrentPitcher();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const teamKey = inning.isTop ? 'home' : 'away';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (pitcher) updatePlayerStat(teamKey, pitcher.id, { np: 1 }, 'pitching');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const switchInning = () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (inning.isTop &amp;&amp; inning.number &gt;= 9 &amp;&amp; scores.home &gt; scores.away) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">       </span>setGameEnded(true); setShowSummary(true); addLog(`</span><span class="s2">比賽結束！主隊獲勝</span><span class="s1">`, 'system'); return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addLog(`--- ${inning.number}</span><span class="s2">局</span><span class="s1">${inning.isTop ? '</span><span class="s2">上</span><span class="s1">' : '</span><span class="s2">下</span><span class="s1">'} </span><span class="s2">結束</span><span class="s1"> ---`, 'system');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setOuts(0); resetCount(); setBases([null, null, null]);<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setInning(prev =&gt; prev.isTop ? { ...prev, isTop: false } : { number: prev.number + 1, isTop: true });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const addScore = (runs, isRBI = true) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (runs &lt;= 0) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const scoringTeamKey = inning.isTop ? 'away' : 'home';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const defenseTeamKey = inning.isTop ? 'home' : 'away';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const currentInning = inning.number;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const newScore = scores[scoringTeamKey] + runs;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setScores(prev =&gt; ({ ...prev, [scoringTeamKey]: newScore }));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setLineScores(prev =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const teamScores = { ...prev[scoringTeamKey] };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>teamScores[currentInning] = (teamScores[currentInning] || 0) + runs;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>return { ...prev, [scoringTeamKey]: teamScores };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (isRBI) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const batter = getCurrentBatter();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (batter) updatePlayerStat(scoringTeamKey, batter.id, { rbi: runs });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const pitcher = getCurrentPitcher();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (pitcher) updatePlayerStat(defenseTeamKey, pitcher.id, { r: runs, er: runs }, 'pitching');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addLog(`</span><span class="s2">得分！</span><span class="s1"> ${runs} </span><span class="s2">分進帳</span><span class="s1">`, 'score');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (!inning.isTop &amp;&amp; inning.number &gt;= 9 &amp;&amp; newScore &gt; scores.away) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>setGameEnded(true); setShowSummary(true); addLog(`</span><span class="s2">再見比賽！</span><span class="s1">${teams.home} </span><span class="s2">獲勝！</span><span class="s1">`, 'system');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const addHitStat = () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const team = inning.isTop ? 'away' : 'home';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const defenseTeam = inning.isTop ? 'home' : 'away';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setStats(prev =&gt; ({ ...prev, [team]: { ...prev[team], hits: prev[team].hits + 1 } }));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const pitcher = getCurrentPitcher();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (pitcher) updatePlayerStat(defenseTeam, pitcher.id, { h: 1 }, 'pitching');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const addErrorStat = () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const defenseTeam = inning.isTop ? 'home' : 'away';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setStats(prev =&gt; ({ ...prev, [defenseTeam]: { ...prev[defenseTeam], errors: prev[defenseTeam].errors + 1 } }));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>// --- Game Actions ---</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const handleBaseAction = (action, payload = null) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const baseIndex = activeBaseAction;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const runner = bases[baseIndex];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const teamKey = inning.isTop ? 'away' : 'home';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>saveHistory();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const newBases = [...bases];</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (action === 'place_runner' &amp;&amp; payload) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>newBases[baseIndex] = payload;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>addLog(`</span><span class="s2">放置跑者於</span><span class="s1">${['</span><span class="s2">一</span><span class="s1">','</span><span class="s2">二</span><span class="s1">','</span><span class="s2">三</span><span class="s1">'][baseIndex]}</span><span class="s2">壘</span><span class="s1">: ${payload.name}`, 'system');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>setBases(newBases);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>setActiveBaseAction(null);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// ... rest of handleBaseAction logic (advance, sb, cs, etc.)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (action === 'advance') {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const nextBase = baseIndex + 1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (nextBase &gt; 2) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">             </span>newBases[baseIndex] = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">             </span>addScore(1, false);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">             </span>addLog(`${runner.name} </span><span class="s2">推進回本壘得分</span><span class="s1">`, 'score');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">             </span>setBases(newBases);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">             </span>if (newBases[nextBase]) {<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                 </span>addLog(`</span><span class="s2">無法推進：前方</span><span class="s1">${['</span><span class="s2">一</span><span class="s1">','</span><span class="s2">二</span><span class="s1">','</span><span class="s2">三</span><span class="s1">'][nextBase]}</span><span class="s2">壘有人</span><span class="s1">`, 'error');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                 </span>return;<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">             </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">             </span>newBases[nextBase] = newBases[baseIndex];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">             </span>newBases[baseIndex] = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">             </span>addLog(`${runner.name} </span><span class="s2">推進至</span><span class="s1">${['</span><span class="s2">一</span><span class="s1">','</span><span class="s2">二</span><span class="s1">','</span><span class="s2">三</span><span class="s1">'][nextBase]}</span><span class="s2">壘</span><span class="s1">`, 'system');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">             </span>setBases(newBases);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>setActiveBaseAction(null);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (action === 'sb') {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (baseIndex === 2) { newBases[2] = null; addScore(1, false); addLog(`${runner.name} </span><span class="s2">盜本壘成功</span><span class="s1"> (SB)!`, 'score'); }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>else if (!newBases[baseIndex + 1]) { newBases[baseIndex + 1] = newBases[baseIndex]; newBases[baseIndex] = null; addLog(`${runner.name} </span><span class="s2">盜壘成功</span><span class="s1"> (SB)`, 'system'); }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>else { addLog('</span><span class="s2">前方壘包有人，無法盜壘</span><span class="s1">', 'error'); return; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>updatePlayerStat(teamKey, runner.id, { sb: 1 });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>} else if (action === 'cs') {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>newBases[baseIndex] = null; addLog(`${runner.name} </span><span class="s2">盜壘失敗被刺殺</span><span class="s1"> (CS)`, 'out'); updatePlayerStat(teamKey, runner.id, { cs: 1 });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const newOuts = outs + 1; if (newOuts &gt;= 3) { setOuts(3); setTimeout(switchInning, 1000); } else setOuts(newOuts);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>} else if (action === 'pickoff') {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>newBases[baseIndex] = null; addLog(`${runner.name} </span><span class="s2">被牽制出局</span><span class="s1"> (PO)`, 'out');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const newOuts = outs + 1; if (newOuts &gt;= 3) { setOuts(3); setTimeout(switchInning, 1000); } else setOuts(newOuts);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>} else if (action === 'pr') {<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// </span><span class="s2">修正</span><span class="s1"> ID </span><span class="s2">生成</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>newBases[baseIndex] = { name: '</span><span class="s2">代跑</span><span class="s1">', number: 'PR', id: Date.now() + Math.random() };<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>addLog(`</span><span class="s2">更換代跑</span><span class="s1">`, 'system');<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>else if (action === 'remove') { newBases[baseIndex] = null; addLog(`</span><span class="s2">手動移除跑者</span><span class="s1">`, 'system'); }</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setBases(newBases); setActiveBaseAction(null);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const handleAdvanceOption = (type) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>saveHistory();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let logPrefix = "";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (type === 'wp') { recordPitch('B'); logPrefix = "</span><span class="s2">投手暴投</span><span class="s1"> (WP)</span><span class="s2">！</span><span class="s1">"; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>else if (type === 'pb') { recordPitch('B'); logPrefix = "</span><span class="s2">捕手捕逸</span><span class="s1"> (PB)</span><span class="s2">！</span><span class="s1">"; }</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let newBases = [...bases];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let runs = 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (newBases[2]) { runs++; addLog(`${newBases[2].name} </span><span class="s2">趁傳回本壘得分！</span><span class="s1">`, 'score'); newBases[2] = null; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (newBases[1]) { newBases[2] = newBases[1]; newBases[1] = null; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (newBases[0]) { newBases[1] = newBases[0]; newBases[0] = null; }</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setBases(newBases);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if(runs &gt; 0) addScore(runs, false);</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (type === 'wp' || type === 'pb') addLog(`${logPrefix} </span><span class="s2">壘上跑者全體推進。</span><span class="s1">`, 'error');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>else addLog('</span><span class="s2">跑者全體推進</span><span class="s1"> (Advance All)</span><span class="s2">。</span><span class="s1">', 'system');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setShowAdvanceModal(false);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const handleWildPitch = (isPassedBall) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>handleAdvanceOption(isPassedBall ? 'pb' : 'wp');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const onFielderSelected = (positionNum) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setShowFielderSelector({ show: false, mode: 'out' });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const defenseTeamKey = inning.isTop ? 'home' : 'away';</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// </span><span class="s2">紀錄守備數據</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const fielder = findFielderByPos(defenseTeamKey, positionNum);</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (showFielderSelector.mode === 'out' &amp;&amp; pendingOutType) {</span></p>
<p class="p3"><span class="s3"><span class="Apple-converted-space">        </span>// </span><span class="s1">如果是出局模式，將刺殺記在該球員身上</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (fielder) updatePlayerStat(defenseTeamKey, fielder.id, { po: 1 }, 'fielding');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>handleOut(pendingOutType.text, pendingOutType.type, positionNum);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>setPendingOutType(null);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>} else if (showFielderSelector.mode === 'error') {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// </span><span class="s2">如果是失誤模式</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>addErrorStat();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>addLog(`</span><span class="s2">守備失誤</span><span class="s1"> (${getPosName(positionNum)})`, 'error');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (fielder) updatePlayerStat(defenseTeamKey, fielder.id, { e: 1 }, 'fielding');</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// </span><span class="s2">失誤上壘邏輯</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const batter = getCurrentBatter();<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const batterObj = batter ? { name: batter.name, number: batter.number } : { name: '</span><span class="s2">打者</span><span class="s1">', number: '' };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (batter) updatePlayerStat(inning.isTop ? 'away' : 'home', batter.id, { ab: 1 });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (!bases[0]) {<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const newBases = [...bases]; newBases[0] = batterObj; setBases(newBases);<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>addLog('</span><span class="s2">失誤上壘</span><span class="s1">', 'neutral');<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>advanceBatter();<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const initiateOut = (text, type) =&gt; { setPendingOutType({ text, type }); setShowFielderSelector({ show: true, mode: 'out' }); };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const initiateError = () =&gt; { saveHistory(); recordPitch('X'); setShowFielderSelector({ show: true, mode: 'error' }); };</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const handleOut = (text, type = 'generic', position = '') =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>saveHistory();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const finalText = position ? `${text} (${getPosName(position)})` : text;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addLog(finalText, 'out'); // Removed pitchType</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const batter = getCurrentBatter();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const teamKey = inning.isTop ? 'away' : 'home';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const defenseTeam = inning.isTop ? 'home' : 'away';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (batter) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (type === 'sac_fly') updatePlayerStat(teamKey, batter.id, { sf: 1 });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>else if (type === 'sac_bunt') updatePlayerStat(teamKey, batter.id, { sh: 1 });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>else updatePlayerStat(teamKey, batter.id, { ab: 1 });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const outsToAdd = type === 'double_play' ? 2 : 1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const pitcher = getCurrentPitcher();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (pitcher) updatePlayerStat(defenseTeam, pitcher.id, { ip: outsToAdd * 0.33 }, 'pitching');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>advanceBatter(); resetCount();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let runs = 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (type === 'sac_fly' &amp;&amp; bases[2]) { runs = 1; const newBases = [...bases]; newBases[2] = null; setBases(newBases); addScore(runs, true); addLog(`</span><span class="s2">高飛犧牲打，跑者得分</span><span class="s1">`, 'score'); }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (type === 'groundout_adv') {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const newBases = [...bases];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (newBases[1] &amp;&amp; !newBases[2]) { newBases[2] = newBases[1]; newBases[1] = null; addLog('</span><span class="s2">跑者推進至三壘</span><span class="s1">', 'system'); }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>else if (newBases[0] &amp;&amp; !newBases[1]) { newBases[1] = newBases[0]; newBases[0] = null; addLog('</span><span class="s2">跑者推進至二壘</span><span class="s1">', 'system'); }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>setBases(newBases);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const newOuts = outs + outsToAdd; if (newOuts &gt;= 3) { setOuts(3); setTimeout(switchInning, 1000); } else setOuts(newOuts);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const handleHit = (hitType) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>saveHistory(); recordPitch('X'); resetCount(); let runs = 0; let newBases = [...bases];<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let hitName = ['</span><span class="s2">一壘安打</span><span class="s1">', '</span><span class="s2">二壘安打</span><span class="s1">', '</span><span class="s2">三壘安打</span><span class="s1">', '</span><span class="s2">全壘打</span><span class="s1">'][hitType - 1];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const batter = getCurrentBatter();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// </span><span class="s2">修正</span><span class="s1"> ID </span><span class="s2">生成，使用</span><span class="s1"> Math.random() </span><span class="s2">避免重複</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const batterObj = batter ? { name: batter.name, number: batter.number, id: batter.id } : { name: '</span><span class="s2">打者</span><span class="s1">', number: '', id: Date.now() + Math.random() };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (hitType === 4) { runs = 1 + newBases.filter(b =&gt; b !== null).length; newBases = [null, null, null]; }<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>for (let i = 2; i &gt;= 0; i--) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (newBases[i]) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>if (i + hitType &gt;= 3) { runs++; addLog(`${newBases[i].name} </span><span class="s2">得分</span><span class="s1">`, 'score'); newBases[i] = null; } else { newBases[i + hitType] = newBases[i]; newBases[i] = null; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (hitType - 1 &gt;= 3) { runs++; addLog(`${batterObj.name} </span><span class="s2">場內全壘打</span><span class="s1">`, 'score'); } else { newBases[hitType - 1] = batterObj; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (batter) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>let statsUpdate = { ab: 1, h: 1 };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (hitType === 4) { statsUpdate.hr = 1; statsUpdate.r = 1; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>updatePlayerStat(inning.isTop ? 'away' : 'home', batter.id, statsUpdate);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setBases(newBases); addHitStat(); addScore(runs, true); addLog(`${hitName}</span><span class="s2">！</span><span class="s1">`, 'hit'); advanceBatter();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const handleWalk = (type = 'bb') =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>saveHistory();<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (type !== 'ibb') recordPitch('B');<span class="Apple-converted-space"> </span></span></p>
<p class="p3"><span class="s3"><span class="Apple-converted-space">    </span>resetCount(); // </span><span class="s1">修正：無論是四壞、故意四壞或觸身球，打席結束都應重置球數</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let newBases = [...bases]; let runs = 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const batter = getCurrentBatter();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// </span><span class="s2">修正</span><span class="s1"> ID </span><span class="s2">生成，使用</span><span class="s1"> Math.random() </span><span class="s2">避免重複</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const batterObj = batter ? { name: batter.name, number: batter.number, id: batter.id } : { name: '</span><span class="s2">打者</span><span class="s1">', number: '', id: Date.now() + Math.random() };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (!newBases[0]) newBases[0] = batterObj;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>else if (!newBases[1]) { newBases[1] = newBases[0]; newBases[0] = batterObj; }<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>else if (!newBases[2]) { newBases[2] = newBases[1]; newBases[1] = newBases[0]; newBases[0] = batterObj; }<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>else { runs = 1; addLog(`${newBases[2].name} </span><span class="s2">擠回得分</span><span class="s1">`, 'score'); newBases[2] = newBases[1]; newBases[1] = newBases[0]; newBases[0] = batterObj; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (batter) updatePlayerStat(inning.isTop ? 'away' : 'home', batter.id, { [type==='hbp'?'hbp':'bb']: 1 });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const pitcher = getCurrentPitcher();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const defenseTeam = inning.isTop ? 'home' : 'away';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (pitcher) updatePlayerStat(defenseTeam, pitcher.id, { bb: 1 }, 'pitching');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setBases(newBases); addScore(runs, true); addLog(type === 'ibb' ? '</span><span class="s2">故意四壞</span><span class="s1">' : type === 'hbp' ? '</span><span class="s2">觸身球</span><span class="s1">' : '</span><span class="s2">四壞球</span><span class="s1">', 'walk'); advanceBatter();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const handleStrike = (isLooking = false) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>saveHistory(); recordPitch('S');<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (strikes &lt; 2) { setStrikes(p =&gt; p + 1); addLog(isLooking ? '</span><span class="s2">目送好球</span><span class="s1">' : '</span><span class="s2">揮棒落空</span><span class="s1">', 'neutral'); }<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const batter = getCurrentBatter(); if (batter) updatePlayerStat(inning.isTop ? 'away' : 'home', batter.id, { ab: 1, so: 1 });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const pitcher = getCurrentPitcher(); const defenseTeam = inning.isTop ? 'home' : 'away'; if (pitcher) updatePlayerStat(defenseTeam, pitcher.id, { so: 1 }, 'pitching');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>handleOut(isLooking ? '</span><span class="s2">三振出局</span><span class="s1"> (</span><span class="s4">ꓘ</span><span class="s1">)' : '</span><span class="s2">三振出局</span><span class="s1"> (K)', 'strikeout');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const handleBall = () =&gt; { saveHistory(); recordPitch('B'); if (balls &lt; 3) { setBalls(p =&gt; p + 1); addLog('</span><span class="s2">壞球</span><span class="s1">', 'neutral'); } else { resetCount(); handleWalk('bb'); } };</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">  </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const handleFoul = () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>saveHistory();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>recordPitch('F');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (strikes &lt; 2) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>setStrikes(prev =&gt; prev + 1);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>addLog('</span><span class="s2">界外球</span><span class="s1"> (Foul)', 'neutral');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>addLog('</span><span class="s2">界外球</span><span class="s1"> (2</span><span class="s2">好球後不計</span><span class="s1">)', 'neutral');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const handleFieldersChoice = () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>saveHistory(); recordPitch('X'); resetCount(); let newBases = [...bases]; let runs = 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (newBases[2]) { runs++; newBases[2] = null; }<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (newBases[1]) { newBases[2] = newBases[1]; newBases[1] = null; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (newBases[0]) { newBases[1] = newBases[0]; newBases[0] = null; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const batter = getCurrentBatter(); const batterObj = batter ? { name: batter.name, number: batter.number } : { name: '</span><span class="s2">打者</span><span class="s1">', number: '' };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>newBases[0] = batterObj;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (batter) updatePlayerStat(inning.isTop ? 'away' : 'home', batter.id, { ab: 1 });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setBases(newBases); addScore(runs, true); addLog('</span><span class="s2">野手選擇上壘</span><span class="s1">', 'neutral'); advanceBatter();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const handleResetGame = () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (resetConfirmState) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>setGameStarted(false);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>setGameEnded(false);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>setScores({ away: 0, home: 0 });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>setStats({ away: { hits: 0, errors: 0 }, home: { hits: 0, errors: 0 } });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>setLineScores({ away: {}, home: {} });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>setInning({ number: 1, isTop: true });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>setOuts(0);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>setBalls(0);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>setStrikes(0);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>setBases([null, null, null]);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>setLogs([]);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>setHistory([]);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>setBatterIndices({ away: 0, home: 0 });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>setPitcherIndices({ away: 0, home: 0 });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>setRosters({ away: [], home: [] });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>localStorage.removeItem('baseball_scorer_v27_final');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>setCurrentView('scorer');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>setResetConfirmState(false);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>setResetConfirmState(true);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>setTimeout(() =&gt; setResetConfirmState(false), 3000);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const handleGameSummarySave = (decisions) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addLog(`[</span><span class="s2">比賽結果</span><span class="s1">] </span><span class="s2">勝</span><span class="s1">:${decisions.win} </span><span class="s2">敗</span><span class="s1">:${decisions.loss} </span><span class="s2">救</span><span class="s1">:${decisions.save} MVP:${decisions.mvp}`, 'system');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setShowSummary(false);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const loadDemoRosters = () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const defaultStats = { ab: 0, h: 0, r: 0, rbi: 0, bb: 0, hbp: 0, so: 0, sf: 0, sh: 0, b1: 0, b2: 0, b3: 0, hr: 0, pitching: { ip: 0, h: 0, r: 0, er: 0, bb: 0, so: 0, np: 0 }, fielding: { po: 0, a: 0, e: 0 } };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const demoAway = [</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>{ number: '17', name: 'S. Ohtani', pos: 'DH' }, { number: '50', name: 'M. Betts', pos: 'RF' }, { number: '5', name: 'F. Freeman', pos: '1B' }, { number: '37', name: 'T. Hernandez', pos: 'LF' }, { number: '13', name: 'M. Muncy', pos: '3B' }, { number: '8', name: 'K. Hernandez', pos: 'CF' }, { number: '16', name: 'W. Smith', pos: 'C' }, { number: '9', name: 'G. Lux', pos: '2B' }, { number: '4', name: 'T. Edman', pos: 'SS' }, { number: '0', name: 'J. Flaherty', pos: 'P' }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>].map(p =&gt; ({ ...p, id: Date.now() + Math.random(), ...defaultStats }));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const demoHome = [</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>{ number: '25', name: 'G. Torres', pos: '2B' }, { number: '22', name: 'J. Soto', pos: 'RF' }, { number: '99', name: 'A. Judge', pos: 'CF' }, { number: '27', name: 'G. Stanton', pos: 'DH' }, { number: '13', name: 'J. Chisholm', pos: '3B' }, { number: '28', name: 'A. Rizzo', pos: '1B' }, { number: '11', name: 'A. Volpe', pos: 'SS' }, { number: '28', name: 'A. Wells', pos: 'C' }, { number: '24', name: 'A. Verdugo', pos: 'LF' }, { number: '45', name: 'G. Cole', pos: 'P' }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>].map(p =&gt; ({ ...p, id: Date.now() + Math.random(), ...defaultStats }));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setRosters({ away: demoAway, home: demoHome }); setPitcherIndices({ away: 9, home: 9 });<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setTeamColors({ away: '#1e3a8a', home: '#1e293b' }); // Dodger Blue vs Yankee Dark</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addLog("</span><span class="s2">已匯入</span><span class="s1"> 2024 </span><span class="s2">世界大賽</span><span class="s1"> G1 </span><span class="s2">名單</span><span class="s1">", "system");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const handleAddPlayer = () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (!newPlayer.name || !newPlayer.number) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const pos = rosterType === 'pitcher' ? 'P' : newPlayer.pos;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const newPlayerData = {<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>...newPlayer, pos,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>// </span><span class="s2">修正</span><span class="s1"> ID </span><span class="s2">生成</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>id: Date.now() + Math.random(),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>ab: 0, h: 0, r: 0, rbi: 0, bb: 0, hbp: 0, so: 0, sf: 0, sh: 0, b1: 0, b2: 0, b3: 0, hr: 0,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>pitching: { ip: 0, h: 0, r: 0, er: 0, bb: 0, so: 0, np: 0 },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>fielding: { po: 0, a: 0, e: 0 }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>};</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setRosters(prev =&gt; ({ ...prev, [activeRosterTeam]: [...prev[activeRosterTeam], newPlayerData] }));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setNewPlayer({ number: '', name: '', pos: '' });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const removePlayer = (team, id) =&gt; { setRosters(prev =&gt; ({ ...prev, [team]: prev[team].filter(p =&gt; p.id !== id) })); };</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>// --- Views ---</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const ScoreboardTable = () =&gt; (</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;div className="overflow-x-auto bg-slate-950/50 rounded-lg p-2 mb-4 border border-slate-700"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;table className="w-full text-center text-sm"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;thead&gt;&lt;tr className="text-slate-500 border-b border-slate-700"&gt;&lt;th className="p-1 text-left min-w-[60px]"&gt;</span><span class="s2">隊伍</span><span class="s1">&lt;/th&gt;{[...Array(9)].map((_, i) =&gt; &lt;th key={i} className="p-1 w-8"&gt;{i + 1}&lt;/th&gt;)}&lt;th className="p-1 w-8 text-white font-bold bg-slate-800"&gt;R&lt;/th&gt;&lt;th className="p-1 w-8 text-slate-300"&gt;H&lt;/th&gt;&lt;th className="p-1 w-8 text-slate-300"&gt;E&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;tbody&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;tr className="border-b border-slate-800 text-slate-300"&gt;&lt;td className="p-2 text-left font-bold" style={{color: teamColors.away}}&gt;{teams.away}&lt;/td&gt;{[...Array(9)].map((_, i) =&gt; &lt;td key={i} className="p-1 text-slate-400"&gt;{lineScores.away[i + 1] !== undefined ? lineScores.away[i + 1] : (i &lt; inning.number - 1 || (i === inning.number - 1 &amp;&amp; !inning.isTop) ? 0 : '')}&lt;/td&gt;)}&lt;td className="p-1 font-bold bg-slate-800 text-white"&gt;{scores.away}&lt;/td&gt;&lt;td className="p-1"&gt;{stats.away.hits}&lt;/td&gt;&lt;td className="p-1"&gt;{stats.away.errors}&lt;/td&gt;&lt;/tr&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;tr className="text-slate-300"&gt;&lt;td className="p-2 text-left font-bold" style={{color: teamColors.home}}&gt;{teams.home}&lt;/td&gt;{[...Array(9)].map((_, i) =&gt; &lt;td key={i} className="p-1 text-slate-400"&gt;{lineScores.home[i + 1] !== undefined ? lineScores.home[i + 1] : (i &lt; inning.number - 1 ? 0 : '')}&lt;/td&gt;)}&lt;td className="p-1 font-bold bg-slate-800 text-white"&gt;{scores.home}&lt;/td&gt;&lt;td className="p-1"&gt;{stats.home.hits}&lt;/td&gt;&lt;td className="p-1"&gt;{stats.home.errors}&lt;/td&gt;&lt;/tr&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/tbody&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;/table&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const BoxScoreView = () =&gt; (</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;div className="flex flex-col h-full overflow-hidden"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div className="mb-4"&gt;&lt;select value={activeRosterTeam} onChange={(e) =&gt; setActiveRosterTeam(e.target.value)} className="w-full bg-slate-800 text-white p-3 rounded-lg border border-slate-600 font-bold focus:outline-none focus:border-blue-500 appearance-none text-center" style={{backgroundImage: 'none'}}&gt;&lt;option value="away"&gt;{teams.away} (</span><span class="s2">客隊</span><span class="s1">)&lt;/option&gt;&lt;option value="home"&gt;{teams.home} (</span><span class="s2">主隊</span><span class="s1">)&lt;/option&gt;&lt;/select&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div className="flex justify-center mb-4 gap-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;button onClick={() =&gt; setBoxScoreType('batting')} className={`px-4 py-1 rounded-full text-sm ${boxScoreType === 'batting' ? 'bg-green-600 text-white' : 'bg-slate-700 text-slate-400'}`}&gt;</span><span class="s2">打擊</span><span class="s1">&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;button onClick={() =&gt; setBoxScoreType('pitching')} className={`px-4 py-1 rounded-full text-sm ${boxScoreType === 'pitching' ? 'bg-orange-600 text-white' : 'bg-slate-700 text-slate-400'}`}&gt;</span><span class="s2">投手</span><span class="s1">&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;button onClick={() =&gt; setBoxScoreType('fielding')} className={`px-4 py-1 rounded-full text-sm ${boxScoreType === 'fielding' ? 'bg-blue-600 text-white' : 'bg-slate-700 text-slate-400'}`}&gt;</span><span class="s2">守備</span><span class="s1">&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div className="flex-1 overflow-auto bg-slate-800/50 rounded-lg border border-slate-700/50"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;table className="w-full text-center text-sm"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;thead className="bg-slate-900 text-slate-400 sticky top-0"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>{boxScoreType === 'batting' ? &lt;tr&gt;&lt;th className="p-3 text-left"&gt;</span><span class="s2">打者</span><span class="s1">&lt;/th&gt;&lt;th className="p-3"&gt;AB&lt;/th&gt;&lt;th className="p-3"&gt;H&lt;/th&gt;&lt;th className="p-3"&gt;HR&lt;/th&gt;&lt;th className="p-3"&gt;RBI&lt;/th&gt;&lt;th className="p-3"&gt;AVG&lt;/th&gt;&lt;th className="p-3"&gt;OPS&lt;/th&gt;&lt;/tr&gt; :<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                     </span>boxScoreType === 'pitching' ? &lt;tr&gt;&lt;th className="p-3 text-left"&gt;</span><span class="s2">投手</span><span class="s1">&lt;/th&gt;&lt;th className="p-3"&gt;IP&lt;/th&gt;&lt;th className="p-3"&gt;H&lt;/th&gt;&lt;th className="p-3"&gt;R&lt;/th&gt;&lt;th className="p-3"&gt;BB&lt;/th&gt;&lt;th className="p-3"&gt;SO&lt;/th&gt;&lt;th className="p-3"&gt;ERA&lt;/th&gt;&lt;th className="p-3"&gt;WHIP&lt;/th&gt;&lt;/tr&gt; :</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                     </span>&lt;tr&gt;&lt;th className="p-3 text-left"&gt;</span><span class="s2">野手</span><span class="s1">&lt;/th&gt;&lt;th className="p-3"&gt;</span><span class="s2">位置</span><span class="s1">&lt;/th&gt;&lt;th className="p-3"&gt;PO&lt;/th&gt;&lt;th className="p-3"&gt;A&lt;/th&gt;&lt;th className="p-3"&gt;E&lt;/th&gt;&lt;th className="p-3"&gt;FPCT&lt;/th&gt;&lt;/tr&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/thead&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;tbody className="divide-y divide-slate-700/50"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>{rosters[activeRosterTeam]</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>.filter(p =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                          </span>if (boxScoreType === 'batting') return !isPitcher(p.pos) || p.ab &gt; 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                          </span>if (boxScoreType === 'pitching') return isPitcher(p.pos) || (p.pitching &amp;&amp; p.pitching.ip &gt; 0);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                          </span>return true;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>})</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>.map(p =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>if (!p.pitching) p.pitching = { ip: 0, h: 0, r: 0, er: 0, bb: 0, so: 0, np: 0 };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>if (!p.fielding) p.fielding = { po: 0, a: 0, e: 0 };</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>if (boxScoreType === 'batting') {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>const avg = p.ab &gt; 0 ? (p.h / p.ab).toFixed(3) : '.000'; const obp = (p.ab + p.bb + (p.hbp||0) + p.sf) &gt; 0 ? (p.h + p.bb + (p.hbp||0)) / (p.ab + p.bb + (p.hbp||0) + p.sf) : 0; const slg = p.ab &gt; 0 ? ((p.b1||0) + 2*(p.b2||0) + 3*(p.b3||0) + 4*(p.hr||0)) / p.ab : 0; const ops = (obp + slg).toFixed(3);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>return &lt;tr key={p.id} className="hover:bg-slate-700/30"&gt;&lt;td className="p-3 text-left font-bold text-white"&gt;{p.name}&lt;/td&gt;&lt;td className="p-3 text-slate-300"&gt;{p.ab}&lt;/td&gt;&lt;td className="p-3 font-bold text-yellow-400"&gt;{p.h}&lt;/td&gt;&lt;td className="p-3 text-slate-300"&gt;{p.hr||0}&lt;/td&gt;&lt;td className="p-3 text-slate-300"&gt;{p.rbi}&lt;/td&gt;&lt;td className="p-3 text-blue-300 font-mono"&gt;{avg}&lt;/td&gt;&lt;td className="p-3 text-green-300 font-mono"&gt;{ops}&lt;/td&gt;&lt;/tr&gt;;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>} else if (boxScoreType === 'pitching') {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                             </span>const ip = p.pitching.ip; const displayIP = (Math.floor(ip) + (ip % 1 * 3) / 10).toFixed(1); const era = ip &gt; 0 ? ((p.pitching.er * 9) / ip).toFixed(2) : '0.00'; const whip = ip &gt; 0 ? ((p.pitching.h + p.pitching.bb) / ip).toFixed(2) : '0.00';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                             </span>return &lt;tr key={p.id} className="hover:bg-slate-700/30"&gt;&lt;td className="p-3 text-left font-bold text-white"&gt;{p.name}&lt;/td&gt;&lt;td className="p-3 text-white font-bold"&gt;{displayIP}&lt;/td&gt;&lt;td className="p-3 text-slate-300"&gt;{p.pitching.h}&lt;/td&gt;&lt;td className="p-3 text-slate-300"&gt;{p.pitching.r}&lt;/td&gt;&lt;td className="p-3 text-slate-300"&gt;{p.pitching.bb}&lt;/td&gt;&lt;td className="p-3 text-slate-300"&gt;{p.pitching.so}&lt;/td&gt;&lt;td className="p-3 text-blue-300 font-mono"&gt;{era}&lt;/td&gt;&lt;td className="p-3 text-green-300 font-mono"&gt;{whip}&lt;/td&gt;&lt;/tr&gt;;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                             </span>const totalChances = p.fielding.po + p.fielding.a + p.fielding.e;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                             </span>const fpct = totalChances &gt; 0 ? ((p.fielding.po + p.fielding.a) / totalChances).toFixed(3) : '.000';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                             </span>return &lt;tr key={p.id} className="hover:bg-slate-700/30"&gt;&lt;td className="p-3 text-left font-bold text-white"&gt;{p.name}&lt;/td&gt;&lt;td className="p-3 text-slate-400"&gt;{p.pos}&lt;/td&gt;&lt;td className="p-3 text-slate-300"&gt;{p.fielding.po}&lt;/td&gt;&lt;td className="p-3 text-slate-300"&gt;{p.fielding.a}&lt;/td&gt;&lt;td className="p-3 font-bold text-red-400"&gt;{p.fielding.e}&lt;/td&gt;&lt;td className="p-3 text-blue-300 font-mono"&gt;{fpct}&lt;/td&gt;&lt;/tr&gt;;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>})}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/tbody&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/table&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const RosterView = () =&gt; (</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;div className="flex flex-col h-full"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div className="mb-4 text-center"&gt;&lt;button onClick={loadDemoRosters} className="w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3 rounded-lg flex items-center justify-center gap-2 transition shadow-lg border border-indigo-500"&gt;&lt;FileDown size={20}/&gt; </span><span class="s2">匯入示範名單</span><span class="s1"> (2024 WS)&lt;/button&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div className="mb-2 flex gap-2 items-center"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;select value={activeRosterTeam} onChange={(e) =&gt; setActiveRosterTeam(e.target.value)} className="flex-1 bg-slate-800 text-white p-3 rounded-lg border border-slate-600 font-bold focus:outline-none focus:border-blue-500 appearance-none text-center" style={{backgroundImage: 'none'}}&gt;&lt;option value="away"&gt;{teams.away} (</span><span class="s2">客隊</span><span class="s1">)&lt;/option&gt;&lt;option value="home"&gt;{teams.home} (</span><span class="s2">主隊</span><span class="s1">)&lt;/option&gt;&lt;/select&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div className="relative shrink-0" title="</span><span class="s2">更換隊伍顏色</span><span class="s1">"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;input type="color" value={teamColors[activeRosterTeam]} onChange={(e) =&gt; setTeamColors({...teamColors, [activeRosterTeam]: e.target.value})} className="w-12 h-[50px] p-1 bg-slate-800 border border-slate-600 rounded-lg cursor-pointer" /&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div className="flex gap-2 mb-4"&gt;&lt;button onClick={() =&gt; setRosterType('batter')} className={`flex-1 py-2 rounded-lg font-bold transition ${rosterType === 'batter' ? 'bg-blue-600 text-white' : 'bg-slate-800 text-slate-400 hover:bg-slate-700'}`}&gt;&lt;Dumbbell size={16} className="inline mr-1"/&gt; </span><span class="s2">野手名單</span><span class="s1">&lt;/button&gt;&lt;button onClick={() =&gt; setRosterType('pitcher')} className={`flex-1 py-2 rounded-lg font-bold transition ${rosterType === 'pitcher' ? 'bg-orange-600 text-white' : 'bg-slate-800 text-slate-400 hover:bg-slate-700'}`}&gt;&lt;Swords size={16} className="inline mr-1"/&gt; </span><span class="s2">投手名單</span><span class="s1">&lt;/button&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div className="bg-slate-800 p-3 rounded-lg border border-slate-700 mb-4 flex gap-2"&gt;&lt;input type="text" placeholder="#" className="w-12 bg-slate-900 border border-slate-600 rounded px-2 py-1 text-center" value={newPlayer.number} onChange={e =&gt; setNewPlayer({...newPlayer, number: e.target.value})} /&gt;&lt;input type="text" placeholder="</span><span class="s2">姓名</span><span class="s1">" className="flex-1 bg-slate-900 border border-slate-600 rounded px-2 py-1" value={newPlayer.name} onChange={e =&gt; setNewPlayer({...newPlayer, name: e.target.value})} /&gt;{rosterType === 'batter' &amp;&amp; &lt;input type="text" placeholder="</span><span class="s2">守備</span><span class="s1">" className="w-16 bg-slate-900 border border-slate-600 rounded px-2 py-1 text-center" value={newPlayer.pos} onChange={e =&gt; setNewPlayer({...newPlayer, pos: e.target.value})} /&gt;}&lt;button onClick={handleAddPlayer} className="bg-green-600 hover:bg-green-500 text-white p-2 rounded"&gt;&lt;Plus size={20}/&gt;&lt;/button&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div className="flex-1 overflow-y-auto bg-slate-800/50 rounded-lg p-2 border border-slate-700/50"&gt;&lt;table className="w-full text-left text-sm"&gt;&lt;thead className="text-slate-400 border-b border-slate-700"&gt;&lt;tr&gt;&lt;th className="p-2"&gt;#&lt;/th&gt;&lt;th className="p-2"&gt;</span><span class="s2">姓名</span><span class="s1">&lt;/th&gt;&lt;th className="p-2"&gt;</span><span class="s2">位置</span><span class="s1">&lt;/th&gt;&lt;th className="p-2 text-right"&gt;</span><span class="s2">操作</span><span class="s1">&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;{rosters[activeRosterTeam].filter(p =&gt; rosterType === 'pitcher' ? isPitcher(p.pos) : !isPitcher(p.pos)).map((player) =&gt; (&lt;tr key={player.id} className="border-b border-slate-700/50 hover:bg-slate-700/30"&gt;&lt;td className="p-2 font-mono text-slate-300"&gt;{player.number}&lt;/td&gt;&lt;td className="p-2 text-white font-bold"&gt;{player.name}&lt;/td&gt;&lt;td className="p-2 text-slate-400"&gt;{player.pos}&lt;/td&gt;&lt;td className="p-2 text-right"&gt;&lt;button onClick={() =&gt; removePlayer(activeRosterTeam, player.id)} className="text-red-400 hover:text-red-300"&gt;&lt;Trash2 size={16} /&gt;&lt;/button&gt;&lt;/td&gt;&lt;/tr&gt;))}&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const LogsView = () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const filteredLogs = logs.filter(log =&gt; logFilter === 'all' ? true : log.type === logFilter);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const groupedLogs = filteredLogs.reduce((acc, log) =&gt; { const groupKey = log.inningGroup || '</span><span class="s2">其他</span><span class="s1">'; if (!acc[groupKey]) acc[groupKey] = []; acc[groupKey].push(log); return acc; }, {});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return (</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;div className="flex-1 overflow-hidden flex flex-col h-full bg-slate-950 rounded-lg border border-slate-800"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div className="p-3 border-b border-slate-800 bg-slate-900/90"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">           </span>&lt;div className="flex justify-between items-center mb-3"&gt;&lt;h2 className="font-bold text-slate-300 flex items-center gap-2"&gt;&lt;ClipboardList size={18} /&gt; </span><span class="s2">戰報</span><span class="s1"> (</span><span class="s2">由新到舊</span><span class="s1">)&lt;/h2&gt;&lt;button onClick={exportLogs} className="text-xs bg-slate-800 hover:bg-slate-700 text-blue-400 px-3 py-1.5 rounded flex items-center gap-1 transition"&gt;&lt;Download size={14}/&gt; </span><span class="s2">匯出</span><span class="s1">&lt;/button&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">           </span>&lt;div className="flex gap-2 overflow-x-auto pb-1 scrollbar-hide"&gt;{['all', 'score', 'hit', 'out'].map(f =&gt; &lt;button key={f} onClick={() =&gt; setLogFilter(f)} className={`px-3 py-1 rounded-full text-xs font-bold whitespace-nowrap transition ${logFilter === f ? 'bg-blue-600 text-white' : 'bg-slate-800 text-slate-400'}`}&gt;{f === 'all' ? '</span><span class="s2">全部</span><span class="s1">' : f}&lt;/button&gt;)}&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div className="flex-1 overflow-y-auto p-4 font-mono text-sm space-y-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>{filteredLogs.reverse().map((log) =&gt; (</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">             </span>&lt;div key={log.id} className={`p-3 rounded border-l-4 ${</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>log.type === 'hit' ? 'bg-blue-900/10 border-blue-500' :</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>log.type === 'score' ? 'bg-purple-900/10 border-purple-500' :</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>log.type === 'out' ? 'bg-red-900/10 border-red-500' :</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>log.type === 'walk' ? 'bg-green-900/10 border-green-500' :</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>log.type === 'error' ? 'bg-orange-900/10 border-orange-500' :</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>log.type === 'system' ? 'bg-slate-800 border-slate-500 text-center text-slate-400 py-1' :</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>'bg-slate-900 border-slate-600'</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}`}&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div className="flex justify-between text-xs text-slate-500 mb-1"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;span&gt;{log.time}&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;span&gt;{log.inningLabel} {log.team}&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div className={log.type==='system'?'text-center text-slate-400':'text-slate-200'}&gt;{log.action}&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">             </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>))}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;div ref={logsEndRef} /&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!gameStarted) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return (</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;div className="min-h-screen bg-slate-900 flex items-center justify-center p-4 font-sans text-white"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div className="bg-slate-800 p-8 rounded-2xl shadow-xl w-full max-w-md border border-slate-700"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;div className="flex justify-center mb-6 text-blue-400"&gt;&lt;Trophy size={64} /&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;h1 className="text-3xl font-bold text-center mb-8"&gt;</span><span class="s2">棒球計分板</span><span class="s1">&lt;/h1&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;div className="space-y-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div className="flex gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div className="flex-1"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;label className="block text-sm text-slate-400 mb-1"&gt;</span><span class="s2">客隊</span><span class="s1"> (</span><span class="s2">先攻</span><span class="s1">)&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div className="flex gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;input type="text" value={teams.away} onChange={(e) =&gt; setTeams({...teams, away: e.target.value})} className="w-full bg-slate-700 border border-slate-600 rounded px-4 py-2" /&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div className="relative"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;input type="color" value={teamColors.away} onChange={(e) =&gt; setTeamColors({...teamColors, away: e.target.value})} className="w-10 h-10 p-0 border-0 rounded overflow-hidden cursor-pointer" /&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div className="flex gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div className="flex-1"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;label className="block text-sm text-slate-400 mb-1"&gt;</span><span class="s2">主隊</span><span class="s1"> (</span><span class="s2">後攻</span><span class="s1">)&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div className="flex gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;input type="text" value={teams.home} onChange={(e) =&gt; setTeams({...teams, home: e.target.value})} className="w-full bg-slate-700 border border-slate-600 rounded px-4 py-2" /&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div className="relative"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;input type="color" value={teamColors.home} onChange={(e) =&gt; setTeamColors({...teamColors, home: e.target.value})} className="w-10 h-10 p-0 border-0 rounded overflow-hidden cursor-pointer" /&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div className="flex gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;button onClick={() =&gt; { loadDemoRosters(); setGameStarted(true); }} className="flex-1 bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3 rounded-lg mt-4 flex items-center justify-center gap-2 text-sm"&gt;&lt;FileDown size={18}/&gt; </span><span class="s2">載入</span><span class="s1"> 2024 WS </span><span class="s2">名單</span><span class="s1">&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;button onClick={() =&gt; setGameStarted(true)} className="flex-1 bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-lg mt-4 flex items-center justify-center gap-2 text-sm"&gt;&lt;Activity size={18}/&gt; </span><span class="s2">直接開始</span><span class="s1">&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const currentBatter = getCurrentBatter();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const currentPitcher = getCurrentPitcher();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const runnersOnBase = bases.some(b =&gt; b !== null);</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">  </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const currentOffenseRoster = rosters[inning.isTop ? 'away' : 'home'];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const currentDefenseRoster = rosters[inning.isTop ? 'home' : 'away'];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const currentOffenseTeamName = inning.isTop ? teams.away : teams.home;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const currentDefenseTeamName = inning.isTop ? teams.home : teams.away;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>// </span><span class="s2">動態樣式</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const currentBattingColor = inning.isTop ? teamColors.away : teamColors.home;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const currentPitchingColor = inning.isTop ? teamColors.home : teamColors.away;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>return (</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;div className="min-h-screen bg-slate-900 text-white flex flex-col font-sans h-screen overflow-hidden relative" style={{'--team-away': teamColors.away, '--team-home': teamColors.home}}&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>{activeBaseAction !== null &amp;&amp; &lt;BaseActionModal baseIndex={activeBaseAction} runner={bases[activeBaseAction]} onClose={() =&gt; setActiveBaseAction(null)} onAction={handleBaseAction} roster={currentOffenseRoster} /&gt;}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>{showFielderSelector.show &amp;&amp; &lt;FielderSelector title={showFielderSelector.mode === 'error' ? '</span><span class="s2">失誤球員</span><span class="s1">' : '</span><span class="s2">接殺</span><span class="s1">/</span><span class="s2">刺殺球員</span><span class="s1">'} onSelect={onFielderSelected} onCancel={() =&gt; setShowFielderSelector({show: false, mode: 'out'})} /&gt;}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>{showSummary &amp;&amp; &lt;GameSummaryModal scores={scores} teams={teams} rosters={rosters} onSave={handleGameSummarySave} onClose={() =&gt; setShowSummary(false)} /&gt;}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>{subModal.isOpen &amp;&amp; &lt;SubstitutionModal teamName={subModal.role === 'batter' ? currentOffenseTeamName : currentDefenseTeamName} role={subModal.role} roster={subModal.role === 'batter' ? currentOffenseRoster : currentDefenseRoster} currentId={subModal.role === 'batter' ? currentBatter?.id : currentPitcher?.id} onConfirm={handleSubstitutionConfirm} onClose={() =&gt; setSubModal({ isOpen: false, role: null })} /&gt;}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>{showAdvanceModal &amp;&amp; &lt;AdvanceOptionModal onClose={() =&gt; setShowAdvanceModal(false)} onAction={handleAdvanceOption} /&gt;}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>{showHotkeysHelp &amp;&amp; &lt;HotkeyHelpModal onClose={() =&gt; setShowHotkeysHelp(false)} /&gt;}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;div className="bg-slate-900 border-b border-slate-800 p-2 flex gap-2 sticky top-0 z-40 shadow-md overflow-x-auto"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;button onClick={() =&gt; setGameStarted(false)} className="px-3 py-2 rounded-lg flex items-center justify-center text-slate-400 hover:bg-slate-800 hover:text-white transition" title="</span><span class="s2">返回首頁</span><span class="s1">"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;Home size={18}/&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;button onClick={() =&gt; setCurrentView('scorer')} className={`px-4 py-2 rounded-lg flex items-center gap-2 text-sm font-bold whitespace-nowrap transition ${currentView === 'scorer' ? 'bg-blue-600 text-white' : 'bg-slate-800 text-slate-400'}`} style={currentView === 'scorer' ? {backgroundColor: currentBattingColor} : {}}&gt;&lt;PlayCircle size={16}/&gt; </span><span class="s2">比賽</span><span class="s1"> (Play)&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;button onClick={() =&gt; setCurrentView('boxscore')} className={`px-4 py-2 rounded-lg flex items-center gap-2 text-sm font-bold whitespace-nowrap transition ${currentView === 'boxscore' ? 'bg-blue-600 text-white' : 'bg-slate-800 text-slate-400'}`} style={currentView === 'boxscore' ? {backgroundColor: currentBattingColor} : {}}&gt;&lt;Table size={16}/&gt; </span><span class="s2">數據</span><span class="s1"> (Stats)&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;button onClick={() =&gt; setCurrentView('roster')} className={`px-4 py-2 rounded-lg flex items-center gap-2 text-sm font-bold whitespace-nowrap transition ${currentView === 'roster' ? 'bg-blue-600 text-white' : 'bg-slate-800 text-slate-400'}`} style={currentView === 'roster' ? {backgroundColor: currentBattingColor} : {}}&gt;&lt;Users size={16}/&gt; </span><span class="s2">名單</span><span class="s1"> (Roster)&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;button onClick={() =&gt; setCurrentView('logs')} className={`px-4 py-2 rounded-lg flex items-center gap-2 text-sm font-bold whitespace-nowrap transition ${currentView === 'logs' ? 'bg-blue-600 text-white' : 'bg-slate-800 text-slate-400'}`} style={currentView === 'logs' ? {backgroundColor: currentBattingColor} : {}}&gt;&lt;ClipboardList size={16}/&gt; </span><span class="s2">戰報</span><span class="s1"> (Logs)&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;div className="flex-1 overflow-hidden relative"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>{currentView === 'scorer' &amp;&amp; (</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;div className="flex flex-col md:flex-row h-full"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div className="flex-1 p-3 overflow-y-auto pb-24 md:pb-4"&gt;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">              </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;ScoreboardTable /&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;div className="flex flex-col gap-2 mb-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div className="flex justify-between items-center bg-slate-800/50 p-2 rounded-lg border border-slate-700/50"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;div className="text-slate-400 font-bold flex items-center gap-2 text-sm"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>&lt;span className="px-2 py-1 rounded text-white" style={{backgroundColor: inning.isTop ? teamColors.away : teamColors.home}}&gt;{inning.number}{inning.isTop ? '</span><span class="s2">上</span><span class="s1">' : '</span><span class="s2">下</span><span class="s1">'}&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>{gameEnded ? &lt;span className="text-yellow-400 font-bold"&gt;</span><span class="s2">比賽結束</span><span class="s1">&lt;/span&gt; : (inning.isTop ? `${teams.away} </span><span class="s2">進攻</span><span class="s1">` : `${teams.home} </span><span class="s2">進攻</span><span class="s1">`)}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;div className="flex items-center gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>{inning.number &gt;= 10 &amp;&amp; &lt;button onClick={() =&gt; {saveHistory(); const nb=[...bases]; nb[1]={name:'Ghost',number:'GR'}; setBases(nb); addLog('</span><span class="s2">突破僵局制</span><span class="s1">', 'system');}} className="text-xs bg-purple-900/40 text-purple-300 px-2 py-1 rounded border border-purple-500/30"&gt;</span><span class="s2">突破僵局</span><span class="s1">&lt;/button&gt;}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>{/* NEW RESET BUTTON HERE */}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button onClick={handleResetGame} className={`text-xs px-3 py-1.5 rounded flex items-center gap-1 transition ${resetConfirmState ? 'bg-red-600 text-white' : 'bg-slate-700 hover:bg-slate-600 text-slate-200'}`}&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;RotateCcw size={14}/&gt; {resetConfirmState ? '</span><span class="s2">確定</span><span class="s1">?' : '</span><span class="s2">重置</span><span class="s1">'}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/button&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button onClick={handleUndo} disabled={history.length === 0} className="text-xs bg-slate-700 hover:bg-slate-600 text-slate-200 px-3 py-1.5 rounded flex items-center gap-1 disabled:opacity-30"&gt;&lt;Undo2 size={14}/&gt; </span><span class="s2">復原</span><span class="s1">&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button onClick={() =&gt; setShowHotkeysHelp(true)} className="text-xs bg-slate-700 hover:bg-slate-600 text-slate-200 px-2 py-1 rounded flex items-center gap-1"&gt;&lt;Keyboard size={14}/&gt;&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button onClick={() =&gt; setShowSummary(true)} className="text-xs bg-yellow-600 hover:bg-yellow-500 text-white px-2 py-1 rounded flex items-center gap-1"&gt;&lt;Medal size={14}/&gt;&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div className="grid grid-cols-2 gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div className="bg-slate-800 p-2 rounded-lg border border-blue-500/30 shadow-lg relative overflow-hidden" style={{borderColor: `${currentBattingColor}4D`}}&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                       </span>&lt;div className="absolute top-0 right-0 text-[9px] px-1.5 py-0.5 text-white rounded-bl" style={{backgroundColor: currentBattingColor}}&gt;BATTER&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                       </span>&lt;div className="flex items-center gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                          </span>&lt;div className="bg-slate-700 p-1.5 rounded-full"&gt;&lt;Target size={16} style={{color: currentBattingColor}}/&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                          </span>&lt;div className="flex-1 min-w-0"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                             </span>&lt;div className="text-[10px] text-slate-500 font-bold uppercase tracking-wider truncate"&gt;At Bat&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                             </span>{currentBatter ? (</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                 </span>&lt;div className="truncate"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                     </span>&lt;span className="text-lg font-bold text-white font-mono mr-1"&gt;{currentBatter.number}&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                     </span>&lt;span className="text-sm text-white font-bold"&gt;{currentBatter.name}&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                     </span>&lt;div className="text-[10px] text-slate-400"&gt;{currentBatter.h}-{currentBatter.ab} (AVG {(currentBatter.ab&gt;0?(currentBatter.h/currentBatter.ab).toFixed(3):'.000')})&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                 </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                             </span>) : &lt;div className="text-slate-500 text-xs italic"&gt;</span><span class="s2">無打者資料</span><span class="s1">&lt;/div&gt;}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                          </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                       </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                       </span>&lt;div className="mt-2 flex gap-1 justify-end"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                          </span>&lt;button onClick={() =&gt; openSubstitutionModal('batter')} className="text-[10px] bg-slate-700 px-2 py-1 rounded text-slate-300 hover:text-white transition flex items-center gap-1 border border-slate-600" style={{'--hover-color': currentBattingColor}}&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                              </span>&lt;UserCog size={12}/&gt; </span><span class="s2">換人</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                          </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                       </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div className="bg-slate-800 p-2 rounded-lg border border-orange-500/30 shadow-lg relative overflow-hidden" style={{borderColor: `${currentPitchingColor}4D`}}&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                       </span>&lt;div className="absolute top-0 right-0 text-[9px] px-1.5 py-0.5 text-white rounded-bl" style={{backgroundColor: currentPitchingColor}}&gt;PITCHER&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                       </span>&lt;div className="flex items-center gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                          </span>&lt;div className="bg-slate-700 p-1.5 rounded-full"&gt;&lt;Disc size={16} style={{color: currentPitchingColor}}/&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                          </span>&lt;div className="flex-1 min-w-0"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                             </span>&lt;div className="text-[10px] text-slate-500 font-bold uppercase tracking-wider truncate"&gt;Pitching&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                             </span>{currentPitcher ? (</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                 </span>&lt;div className="truncate"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                     </span>&lt;span className="text-lg font-bold text-white font-mono mr-1"&gt;{currentPitcher.number}&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                     </span>&lt;span className="text-sm text-white font-bold"&gt;{currentPitcher.name}&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                     </span>&lt;div className="text-[10px] text-slate-400"&gt;Pitches: &lt;span className="text-yellow-400 font-bold"&gt;{currentPitcher.pitching.np}&lt;/span&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                 </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                             </span>) : &lt;div className="text-slate-500 text-xs italic"&gt;</span><span class="s2">無投手資料</span><span class="s1">&lt;/div&gt;}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                          </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                       </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                       </span>&lt;div className="mt-2 flex gap-1 justify-end"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                          </span>&lt;button onClick={() =&gt; openSubstitutionModal('pitcher')} className="text-[10px] bg-slate-700 px-2 py-1 rounded text-slate-300 hover:text-white transition flex items-center gap-1 border border-slate-600"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                              </span>&lt;UserCog size={12}/&gt; </span><span class="s2">換投</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                          </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                       </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;PitchClock bases={bases} /&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;div className="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div className="bg-green-800/20 rounded-xl p-4 relative h-64 flex items-center justify-center border border-green-900/50 overflow-hidden"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;div className="absolute inset-0 opacity-10 bg-[radial-gradient(#000_1px,transparent_1px)] [background-size:16px_16px]"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;div className="relative w-40 h-40 transform rotate-45 border-2 border-amber-700/50 bg-amber-900/20"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div className="absolute bottom-[-12px] right-[-12px] w-8 h-8 bg-white z-10 shadow-lg" style={{transform: 'rotate(-45deg)', clipPath: 'polygon(50% 100%, 0 50%, 0 0, 100% 0, 100% 50%)'}}&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div onClick={() =&gt; setActiveBaseAction(0)} className={`absolute top-[-10px] right-[-10px] w-7 h-7 shadow-lg border-2 border-white transition-all duration-300 cursor-pointer hover:scale-125 z-20 flex items-center justify-center ${bases[0] ? 'bg-yellow-400' : 'bg-white/30 hover:bg-white/50'}`}&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                       </span>{bases[0] &amp;&amp; &lt;span className="text-[9px] font-bold text-black -rotate-45"&gt;{bases[0].number}&lt;/span&gt;}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div onClick={() =&gt; setActiveBaseAction(1)} className={`absolute top-[-10px] left-[-10px] w-7 h-7 shadow-lg border-2 border-white transition-all duration-300 cursor-pointer hover:scale-125 z-20 flex items-center justify-center ${bases[1] ? 'bg-yellow-400' : 'bg-white/30 hover:bg-white/50'}`}&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                       </span>{bases[1] &amp;&amp; &lt;span className="text-[9px] font-bold text-black -rotate-45"&gt;{bases[1].number}&lt;/span&gt;}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div onClick={() =&gt; setActiveBaseAction(2)} className={`absolute bottom-[-10px] left-[-10px] w-7 h-7 shadow-lg border-2 border-white transition-all duration-300 cursor-pointer hover:scale-125 z-20 flex items-center justify-center ${bases[2] ? 'bg-yellow-400' : 'bg-white/30 hover:bg-white/50'}`}&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                       </span>{bases[2] &amp;&amp; &lt;span className="text-[9px] font-bold text-black -rotate-45"&gt;{bases[2].number}&lt;/span&gt;}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div className="bg-slate-800 rounded-xl p-6 border border-slate-700 flex flex-col justify-center gap-4 relative"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;div className="absolute top-4 right-4 flex gap-1"&gt;{pitchSequence.map((p, idx) =&gt; &lt;div key={idx} className={`w-2 h-2 rounded-full ${p==='B'?'bg-green-500':p==='X'?'bg-blue-500':p==='F'?'bg-slate-400':'bg-yellow-500'}`} title={p}&gt;&lt;/div&gt;)}&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;div className="flex items-center justify-between px-4"&gt;&lt;span className="text-2xl font-black text-green-500 font-mono w-8"&gt;B&lt;/span&gt;&lt;div className="flex gap-3"&gt;{[...Array(3)].map((_, i) =&gt; &lt;div key={i} className={`w-6 h-6 rounded-full border-2 border-green-900 ${i &lt; balls ? 'bg-green-500 shadow-glow-green' : 'bg-slate-700'}`}&gt;&lt;/div&gt;)}&lt;/div&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;div className="flex items-center justify-between px-4"&gt;&lt;span className="text-2xl font-black text-yellow-500 font-mono w-8"&gt;S&lt;/span&gt;&lt;div className="flex gap-3"&gt;{[...Array(2)].map((_, i) =&gt; &lt;div key={i} className={`w-6 h-6 rounded-full border-2 border-yellow-900 ${i &lt; strikes ? 'bg-yellow-500 shadow-glow-yellow' : 'bg-slate-700'}`}&gt;&lt;/div&gt;)}&lt;/div&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;div className="flex items-center justify-between px-4"&gt;&lt;span className="text-2xl font-black text-red-500 font-mono w-8"&gt;O&lt;/span&gt;&lt;div className="flex gap-3"&gt;{[...Array(2)].map((_, i) =&gt; &lt;div key={i} className={`w-6 h-6 rounded-full border-2 border-red-900 ${i &lt; outs ? 'bg-red-500 shadow-glow-red' : 'bg-slate-700'}`}&gt;&lt;/div&gt;)}&lt;/div&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>{!gameEnded &amp;&amp; (</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;div className="grid grid-cols-1 md:grid-cols-2 gap-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div className="bg-slate-800 p-3 rounded-xl border border-slate-700"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;h3 className="text-slate-400 text-xs font-bold mb-2 uppercase tracking-wider flex justify-between items-center"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>&lt;span&gt;</span><span class="s2">投球判定</span><span class="s1">&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/h3&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;div className="grid grid-cols-2 gap-2 mt-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button onClick={handleBall} className="bg-green-900/40 hover:bg-green-800/60 text-green-400 border border-green-700/50 py-3 rounded font-bold transition"&gt;</span><span class="s2">壞球</span><span class="s1"> (B)&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button onClick={() =&gt; handleStrike(false)} className="bg-yellow-900/40 hover:bg-yellow-800/60 text-yellow-400 border border-yellow-700/50 py-3 rounded font-bold transition"&gt;</span><span class="s2">揮棒落空</span><span class="s1"> (S)&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button onClick={() =&gt; handleStrike(true)} className="bg-yellow-900/20 hover:bg-yellow-800/40 text-yellow-200 border border-yellow-700/30 py-2 rounded text-sm transition"&gt;</span><span class="s2">目送好球</span><span class="s1"> (K)&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button onClick={handleFoul} className="bg-slate-700 hover:bg-slate-600 text-slate-300 py-2 rounded font-bold transition text-sm"&gt;</span><span class="s2">界外</span><span class="s1"> (F)&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button onClick={() =&gt; { handleWalk('ibb'); }} className="bg-indigo-900/40 hover:bg-indigo-800/60 text-indigo-300 border border-indigo-700/50 py-2 rounded font-bold transition text-xs flex items-center justify-center gap-1 col-span-1"&gt;</span><span class="s2">故意四壞</span><span class="s1">&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button onClick={() =&gt; { setPitchCount(p=&gt;p+1); handleWalk('hbp'); }} className="bg-indigo-900/40 hover:bg-indigo-800/60 text-indigo-300 border border-indigo-700/50 py-2 rounded font-bold transition text-xs flex items-center justify-center gap-1 col-span-1"&gt;</span><span class="s2">觸身球</span><span class="s1">&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div className="bg-slate-800 p-3 rounded-xl border border-slate-700"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;h3 className="text-slate-400 text-xs font-bold mb-2 uppercase tracking-wider"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span></span><span class="s2">打擊結果</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/h3&gt;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                  </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;div className="space-y-3 mt-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                     </span>&lt;div className="grid grid-cols-4 gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;button onClick={() =&gt; handleHit(1)} className="bg-blue-600 hover:bg-blue-500 text-white py-2 rounded font-bold text-xs"&gt;</span><span class="s2">一安</span><span class="s1"> (1)&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;button onClick={() =&gt; handleHit(2)} className="bg-blue-600 hover:bg-blue-500 text-white py-2 rounded font-bold text-xs"&gt;</span><span class="s2">二安</span><span class="s1"> (2)&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;button onClick={() =&gt; handleHit(3)} className="bg-blue-600 hover:bg-blue-500 text-white py-2 rounded font-bold text-xs"&gt;</span><span class="s2">三安</span><span class="s1"> (3)&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;button onClick={() =&gt; handleHit(4)} className="bg-purple-600 hover:bg-purple-500 text-white py-2 rounded font-bold text-xs"&gt;</span><span class="s2">全壘打</span><span class="s1"> (4)&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                     </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                     </span>&lt;div className="grid grid-cols-4 gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;button onClick={() =&gt; initiateOut('</span><span class="s2">滾地出局</span><span class="s1">', 'groundout')} className="bg-red-700 hover:bg-red-600 text-white py-2 rounded font-bold text-xs"&gt;</span><span class="s2">滾地</span><span class="s1">&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;button onClick={() =&gt; initiateOut('</span><span class="s2">飛球接殺</span><span class="s1">', 'flyout')} className="bg-red-700 hover:bg-red-600 text-white py-2 rounded font-bold text-xs"&gt;</span><span class="s2">飛球</span><span class="s1">&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;button onClick={() =&gt; initiateOut('</span><span class="s2">平飛接殺</span><span class="s1">', 'lineout')} className="bg-red-700 hover:bg-red-600 text-white py-2 rounded font-bold text-xs"&gt;</span><span class="s2">平飛</span><span class="s1">&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;button onClick={() =&gt; handleOut('</span><span class="s2">雙殺打</span><span class="s1">', 'double_play')} className="bg-red-900 hover:bg-red-800 text-red-100 py-2 rounded font-bold text-xs border border-red-700"&gt;</span><span class="s2">雙殺</span><span class="s1">&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                     </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                     </span>&lt;div className="grid grid-cols-4 gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;button onClick={() =&gt; handleOut('</span><span class="s2">高飛犧牲打</span><span class="s1">', 'sac_fly')} className="bg-yellow-700 hover:bg-yellow-600 text-white py-1 rounded text-[10px]"&gt;</span><span class="s2">高飛犧牲</span><span class="s1">&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;button onClick={() =&gt; handleOut('</span><span class="s2">犧牲觸擊</span><span class="s1">', 'sac_bunt')} className="bg-yellow-700 hover:bg-yellow-600 text-white py-1 rounded text-[10px]"&gt;</span><span class="s2">短打犧牲</span><span class="s1">&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;button onClick={handleFieldersChoice} className="bg-slate-600 hover:bg-slate-500 text-white py-1 rounded text-[10px]"&gt;</span><span class="s2">野選</span><span class="s1">&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;button onClick={initiateError} className="bg-orange-700 hover:bg-orange-600 text-white py-1 rounded text-[10px]"&gt;</span><span class="s2">失誤</span><span class="s1">&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                     </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                     </span>&lt;button onClick={() =&gt; initiateOut('</span><span class="s2">滾地推進</span><span class="s1">', 'groundout_adv')} className="w-full bg-slate-700 hover:bg-slate-600 text-slate-300 py-1.5 rounded text-[10px] flex items-center justify-center border border-slate-600"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s2">滾地出局但推進跑者</span><span class="s1"> (Productive Out)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                     </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>)}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div className="hidden md:flex w-64 bg-slate-950 border-l border-slate-800 flex-col"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">               </span>&lt;div className="p-3 bg-slate-900/90 font-bold text-xs text-slate-400 border-b border-slate-800"&gt;</span><span class="s2">最新戰況</span><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">               </span>&lt;div className="flex-1 p-2 space-y-2 overflow-hidden"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                 </span>{logs.slice(-8).map((log) =&gt; (</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div key={log.id} className="text-xs p-2 bg-slate-900 border border-slate-800 rounded text-slate-300"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                       </span>&lt;span className="text-slate-500 mr-1 block"&gt;{log.time}&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                       </span>{log.action}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                 </span>))}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">               </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>)}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>{currentView === 'roster' &amp;&amp; &lt;div className="h-full p-4 max-w-2xl mx-auto"&gt;&lt;RosterView /&gt;&lt;/div&gt;}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>{currentView === 'boxscore' &amp;&amp; &lt;div className="h-full p-4 max-w-2xl mx-auto"&gt;&lt;BoxScoreView /&gt;&lt;/div&gt;}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>{currentView === 'logs' &amp;&amp; &lt;div className="h-full p-4 max-w-2xl mx-auto"&gt;&lt;LogsView /&gt;&lt;/div&gt;}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">      </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;style&gt;{`</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.clip-home-plate { clip-path: polygon(50% 0%, 100% 50%, 100% 100%, 0% 100%, 0% 50%); }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.shadow-glow-green { box-shadow: 0 0 10px rgba(34,197,94,0.6); }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.shadow-glow-yellow { box-shadow: 0 0 10px rgba(234,179,8,0.6); }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.shadow-glow-red { box-shadow: 0 0 10px rgba(239,68,68,0.6); }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.scrollbar-hide::-webkit-scrollbar { display: none; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>`}&lt;/style&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>);</span></p>
<p class="p1"><span class="s1">}</span></p>
</body>
</html>
